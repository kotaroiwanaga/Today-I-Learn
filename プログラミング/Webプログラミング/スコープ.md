## はじめに
本説明はサーブレットとJSPを用いたWebプログラミングを想定した説明となっていることに注意。

## スコープとは
インスタンスを保存できる領域。スコープを経由させることで複数ファイル間でのインスタンスの共有が可能になる。なお、スコープに保存データはJavaBeansと呼ばれる以下のルールを守ったインスタンスのみとなる。(フレームワークの利用などにより異なるかも。)  
1. 直列可能である(java.io.Serializeを継承している。)。
2. クラスはpublicかつパッケージに所属している。
3. publicで引数のないコンストラクタを持つ。
4. フィールドはカプセル化する。
5. 命名規則に従ったgetter/setterを持つ。

### リクエストスコープ
リクエストごとに生成されるスコープ。  
このスコープに保存したインスタンスは、レスポンスが返されるまで利用することができる。  
⇒サーブレットのインスタンスをフォワード先のJSPで利用できる。  
⇒リダイレクト先は違うリクエストになって今うためインスタンスを共有できない。  

- リクエストスコープからインスタンスを取得
```
取得するインスタンスの型 変数名 = (取得するインスタンスの型)request.getAttribute("属性名");
```
- リクエストスコープにインスタンスを保存
```
request.setAttribue("属性名", インスタンス);
```

### セッションスコープ
リクエストをまたいでインスタンスを利用できるスコープ。  
セッションスコープに保存したインスタンスの有効期間は開発者が決めることができる。  
明示的に削除したりしないかぎり、インスタンスの有効期間はユーザブラウザを閉じるまで、  もしくはセッションが30分以上使用されていない場合にタイムアウトとなってガベージコレクションの対象となる。このタイムアウトの時間は設定可能。

- セッションスコープの取得
```
HttpSession session = request.getSession();
```
※JSPの場合は暗黙オブジェクト「session」が使用できるのでgetSession()は不要。  

- セッションスコープに保存する
```
session.setAttribute("属性名", インスタンス);
```
- セッションスコープからインスタンスを取得する
```
取得するインスタンスの型 変数名 = (取得するインスタンスの型)session.getAttribute("属性名");
```
- セッションスコープからインスタンスを削除
```
session.removeAttribute("属性名");
```
- セッションスコープを破棄する。
```
session.invalidate();
```
### アプリケーションスコープ
1つのアプリケーションにつき1つ生成されるスコープ。  
Webアプリケーションが終了するまでの間、アプリケーション内のすべてのサーブレットクラストJSPファイルで利用可能。

#### 注意点
アプリケーションスコープ内のインスタンスを更新するような処理を複数のリクエストがほぼ同じタイミングで行うと、アプリケーションスコープのインスタンスに不整合が発生宇する可能性がある。  
対策としてデータの不整合が起きるとまずいものはアプリケーションスコープに保存しないか、取得のみで更新しないようにするなどの工夫が必要。
あるいはすスレッドよにる競合が発生しないよう調停を行う。

- アプリケーションスコープを取得する
```
ServletContext application = this.getServletContext();
```
※JSPの場合は暗黙インスタンスapplicationが用意されている。

- アプリケーションスコープに保存する
```
application.setAttribute("属性名", インスタンス);
```
- アプリケーションスコープに保存
```
application.setAttribute("属性名", インスタンス);
```
- アプリケーションスコープからインスタンスを取得する
```
取得するインスタンスの型 変数名 = (取得するインスタンスの型)application.getAttribute("属性名");
```
- アプリケーションスコープからインスタンスを削除する
```
application.removeAttribute("属性名");
```
## 参考
[[書籍]スッキリわかるサーブレット＆JSP入門](https://sukkiri.jp/books/sukkiri_servlet2)
