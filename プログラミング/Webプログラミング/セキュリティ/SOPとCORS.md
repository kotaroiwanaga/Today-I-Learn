# SOPとCORS

# そもそもオリジンとは？
**オリジン = スキーム + ホスト + ポート**

例) `http://www.example.com:80/index.html`のURLを例にすると
- スキーム = `http://`
- ホスト = `www.example.com`
- ポート = `80`(ポート番号「80」は省略可なので普段見かけることは少ない)

⇒ オリジン = `http://www.example.com:80`

#　同一オリジンポリシー(SOP)
## SOPの概要
**SOP = Same-Origin Policy**

SOPは、ある2つのURLに関してオリジンが同一(**同一オリジン**)であるか、異なる折地(**クロスオリジン**)であるかによって、オリジン間のリソース共有に制限をかけるWebセキュリティーポリシーである。基本的に同一オリジンでは同一のリソースを共有し、クロスオリジンでは異なるリソースを持つという考えをもとに定められている。  

まとめると「同一オリジンポリシー」とはWeb上の様様な挙動について、対象が
- 同一オリジンの場合： 原則として**リソースの読み書きが可能**
- クロスオリジンの場合： 原則として**リソースの読み書きが禁止**

になること。

## SOPの目的
SOPはクロスオリジン間のリソース共有に制限をかけることで、以下のような脆弱性を防ぐことを目的としている。

### XSS (Cross Site Scripting)
ここでいう「クロスサイト」とはクロスオリジンのことであり、Client(Webブラウザ)上でWebサイトにアクセスすることで、Webサイトに組み込まれていたスクリプトが実行され、Cookie内のセッション情報などユーザの情報を抜き取られてしまうこと。
SOPによってWebブラウザ-Webサイト間(クロスオリジン間)のリソース共有が制限されることで、Webサイトからクライアントのリソースを取得できないようになっている。

### CSRF (Cross-Site Reequest Forgeries)
CSRFはユーザがある特定のWebサービスにログインした状態で、罠ページにアクセスすることで発生する脆弱性である。
罠ページはクライアント(Webブラウザ)上で、ユーザがログインしているWebサービスに勝手にリクエストを送信する。
リクエストを受け取ったWebサービスから見るとログイン済みのクライアントから来たリクエストであることに違いはないので、
正常なリクエストを受け取った時と同様にWebサーバ側の処理を実行してしまう。これによりユーザが意図しない処理が、ユーザの権限で行われてしまう。

CSRFもXSSと同様にWebブラウザとWebサービス間のクロスサイト(クロスオリジン)間リソース共有による不正行為であるが、Webサービス側はWebブラウザとのリソース共有を許可してしまっているという点で状況が異なる。つまりCSRFはXSSと異なり、自身のリソースをクロスオリジンに共有する側から不正を防ぐことができない。そのためAjax通信を実現する`XMLHttpRequest(XHR)`や`Fetch API`はSOPに従うことで意図せずクロスオリジンにリクエストを送信することを防いでいる。

# 参考

Same-Origin Policyとは何なのか  
http://hasegawa.hatenablog.com/entry/20130330/p1

なんとなく CORS がわかる...はもう終わりにする。  
https://qiita.com/att55/items/2154a8aad8bf1409db2b

XSS と CSRF って結局何が違うのか？  
https://qiita.com/att55/items/a50ca43adde206017525

Ajax | 「分かりそう」で「分からない」でも「分かった」気になれるIT用語辞典  
https://wa3.i-3-i.info/word12672.html

CORSってなに？  
https://aloerina01.github.io/blog/2016-10-13-1
